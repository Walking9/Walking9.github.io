<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Modem代理AP心跳方案 | Walking9&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="基于 LwIP 的 Modem 代理 AP 心跳方案：TCP&#x2F;IP 协议栈移植与实践在智能手机功耗优化领域，AP（Application Processor，应用处理器）的休眠唤醒策略是关键环节。许多应用（如即时通讯、推送服务）依赖周期性心跳包维持网络连接，这会导致 AP 频繁从深度休眠中唤醒，显著增加待机功耗。本文将以 TCP&#x2F;IP 协议栈为技术切入点，详细介绍一种通过 Mo">
<meta property="og:type" content="article">
<meta property="og:title" content="Modem代理AP心跳方案">
<meta property="og:url" content="https://walking9.github.io/2021/12/05/Modem%E4%BB%A3%E7%90%86AP%E5%BF%83%E8%B7%B3%E6%96%B9%E6%A1%88/index.html">
<meta property="og:site_name" content="Walking9&#39;s Blog">
<meta property="og:description" content="基于 LwIP 的 Modem 代理 AP 心跳方案：TCP&#x2F;IP 协议栈移植与实践在智能手机功耗优化领域，AP（Application Processor，应用处理器）的休眠唤醒策略是关键环节。许多应用（如即时通讯、推送服务）依赖周期性心跳包维持网络连接，这会导致 AP 频繁从深度休眠中唤醒，显著增加待机功耗。本文将以 TCP&#x2F;IP 协议栈为技术切入点，详细介绍一种通过 Mo">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-12-04T16:04:58.000Z">
<meta property="article:modified_time" content="2025-08-04T16:37:46.285Z">
<meta property="article:author" content="Walking9">
<meta property="article:tag" content="Modem">
<meta property="article:tag" content="AP">
<meta property="article:tag" content="心跳">
<meta property="article:tag" content="LwIP">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Walking9's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Walking9&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">I try to keep on moving</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://walking9.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Modem代理AP心跳方案" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/05/Modem%E4%BB%A3%E7%90%86AP%E5%BF%83%E8%B7%B3%E6%96%B9%E6%A1%88/" class="article-date">
  <time class="dt-published" datetime="2021-12-04T16:04:58.000Z" itemprop="datePublished">2021-12-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Modem代理AP心跳方案
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="基于-LwIP-的-Modem-代理-AP-心跳方案：TCP-IP-协议栈移植与实践"><a href="#基于-LwIP-的-Modem-代理-AP-心跳方案：TCP-IP-协议栈移植与实践" class="headerlink" title="基于 LwIP 的 Modem 代理 AP 心跳方案：TCP&#x2F;IP 协议栈移植与实践"></a>基于 LwIP 的 Modem 代理 AP 心跳方案：TCP&#x2F;IP 协议栈移植与实践</h1><p>在智能手机功耗优化领域，AP（Application Processor，应用处理器）的休眠唤醒策略是关键环节。许多应用（如即时通讯、推送服务）依赖周期性心跳包维持网络连接，这会导致 AP 频繁从深度休眠中唤醒，显著增加待机功耗。本文将以 TCP&#x2F;IP 协议栈为技术切入点，详细介绍一种通过 Modem 代理 AP 心跳的方案 —— 利用 LwIP 轻量级协议栈在 Modem 侧实现 IPv4&#x2F;IPv6 包解析与代理回复，减少 AP 唤醒次数，最终实现功耗优化。<br>开源轻量级协议栈 LwIP（Lightweight IP）凭借其极致的资源占用控制与灵活的模块化设计，成为该方案的关键技术支撑。本文将从移植实践与功能实现两个维度，详细阐述 LwIP 在 Modem 环境下的适配过程，以及如何基于该协议栈构建完整的心跳代理能力。</p>
<h2 id="方案背景：为何需要-Modem-代理心跳？"><a href="#方案背景：为何需要-Modem-代理心跳？" class="headerlink" title="方案背景：为何需要 Modem 代理心跳？"></a>方案背景：为何需要 Modem 代理心跳？</h2><p>智能手机的网络连接通常由 AP 和 Modem 协同维护：AP 负责运行应用层逻辑，Modem 负责底层网络接入（如 4G&#x2F;5G、Wi-Fi）。传统模式中，心跳包的收发需经过 “Modem 接收→AP 唤醒处理→AP 生成回复→Modem 发送” 全流程，即使简单的心跳回复也会触发 AP 从深度休眠（如 Linux 的 suspend 状态）唤醒，每次唤醒会带来毫秒级的电流峰值（通常从 μA 级跃升至 mA 级）。</p>
<p><strong>核心痛点</strong>：高频心跳（如每 30 秒一次）会导致 AP 每日唤醒数千次，额外消耗 xx% 的待机电量。</p>
<p><strong>优化思路</strong>：Modem 本身需持续维持网络连接（无法深度休眠），可由 Modem 直接解析心跳包并生成回复，无需唤醒 AP。这要求 Modem 具备 TCP&#x2F;IP 协议解析能力 ——LwIP 轻量级协议栈因其体积小、资源占用低（RAM 需求可低至几十 KB），成为 Modem 侧的理想选择。</p>
<h2 id="核心流程"><a href="#核心流程" class="headerlink" title="核心流程"></a>核心流程</h2><ol>
<li>数据包拦截：Modem 通过底层网络转发机制（如基于 802.11 的 MAC 层过滤或 PCIe 通道的数据包镜像）捕获所有目标为 AP 的网络包；</li>
<li>协议解析：利用移植后的 LwIP 协议栈，逐层解析数据包的以太网头部、IPv4&#x2F;IPv6 头部、TCP&#x2F;UDP 头部及应用层数据；</li>
<li>心跳识别：通过预设的规则库（包含目标 IP、端口范围、 payload 特征值等）判断是否为可代理的心跳包；</li>
<li>代理回复：对于合法心跳包，Modem 直接构造响应包并通过网络接口发送，整个过程在 Modem 的低功耗核心中完成，耗时仅 3-8ms；</li>
<li>状态同步：通过共享内存机制维护 AP 与 Modem 的状态一致性，仅当心跳密钥更新、协议变更等特殊场景时，才触发 AP 唤醒进行同步。</li>
</ol>
<h2 id="LwIP-协议栈：轻量级-TCP-IP-解决方案"><a href="#LwIP-协议栈：轻量级-TCP-IP-解决方案" class="headerlink" title="LwIP 协议栈：轻量级 TCP&#x2F;IP 解决方案"></a>LwIP 协议栈：轻量级 TCP&#x2F;IP 解决方案</h2><p>LwIP（Lightweight IP）是瑞典计算机科学研究所开发的开源 TCP&#x2F;IP 协议栈，专为嵌入式系统设计，支持 IPv4、IPv6、TCP、UDP、ICMP 等核心协议，同时提供了 RAW&#x2F;API、NETCONN&#x2F;API 和 Socket&#x2F;API 三种编程接口，兼顾轻量性与易用性。</p>
<p><strong>核心优势</strong>：</p>
<ul>
<li><p>资源占用低：最小配置下 RAM 仅需 40KB，ROM 约 60KB，适合 Modem 等资源受限场景；</p>
</li>
<li><p>可裁剪性：通过<code>lwipopts.h</code>配置文件支持功能模块化裁剪（如仅保留 IPv4+UDP 或 IPv6+TCP）；</p>
</li>
<li><p>移植性强：与硬件和操作系统的耦合通过抽象层实现，适配各类处理器和 RTOS。</p>
</li>
</ul>
<h2 id="LwIP-移植到-Modem-的关键步骤"><a href="#LwIP-移植到-Modem-的关键步骤" class="headerlink" title="LwIP 移植到 Modem 的关键步骤"></a>LwIP 移植到 Modem 的关键步骤</h2><p>Modem 通常基于专用通信芯片（如高通 MDM 系列、联发科 MT62 系列），运行实时操作系统（如 RTOS、ThreadX）。将 LwIP 移植到 Modem 需完成以下核心工作：</p>
<h3 id="1-硬件适配：网络接口驱动实现"><a href="#1-硬件适配：网络接口驱动实现" class="headerlink" title="1. 硬件适配：网络接口驱动实现"></a>1. 硬件适配：网络接口驱动实现</h3><p>LwIP 通过<code>netif</code>结构体管理网络接口，需为 Modem 的网络硬件（如基带芯片的 MAC 接口）实现数据收发驱动。</p>
<p><strong>关键接口</strong>：</p>
<ul>
<li><p><code>low_level_init()</code>：初始化硬件（如配置 PHY、设置 MAC 地址、使能中断）；</p>
</li>
<li><p><code>low_level_output()</code>：将 LwIP 封装的数据包发送到物理层；</p>
</li>
<li><p><code>low_level_input()</code>：从物理层接收数据包并提交给 LwIP 协议栈。</p>
</li>
</ul>
<p><strong>示例代码框架</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义网络接口结构体</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">netif</span> <span class="title">modem_netif</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 硬件初始化函数</span></span><br><span class="line"><span class="type">static</span> <span class="type">err_t</span> <span class="title function_">low_level_init</span><span class="params">(<span class="keyword">struct</span> netif *netif)</span> &#123;</span><br><span class="line">  netif-&gt;hwaddr_len = <span class="number">6</span>;                  <span class="comment">// MAC地址长度</span></span><br><span class="line">  netif-&gt;hwaddr[<span class="number">0</span>] = <span class="number">0x00</span>;                <span class="comment">// 配置Modem的MAC地址</span></span><br><span class="line">  netif-&gt;hwaddr[<span class="number">1</span>] = <span class="number">0x1A</span>;</span><br><span class="line">  <span class="comment">// ... 其他MAC地址字节</span></span><br><span class="line">  netif-&gt;mtu = <span class="number">1500</span>;                      <span class="comment">// 最大传输单元</span></span><br><span class="line">  netif-&gt;flags = NETIF_FLAG_BROADCAST | NETIF_FLAG_ETHARP; <span class="comment">// 使能广播和ARP</span></span><br><span class="line">  <span class="comment">// 初始化Modem基带的MAC控制器</span></span><br><span class="line">  modem_mac_init();</span><br><span class="line">  <span class="keyword">return</span> ERR_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送函数</span></span><br><span class="line"><span class="type">static</span> <span class="type">err_t</span> <span class="title function_">low_level_output</span><span class="params">(<span class="keyword">struct</span> netif *netif, <span class="keyword">struct</span> pbuf *p)</span> &#123;</span><br><span class="line">  <span class="comment">// 将pbuf链中的数据拷贝到Modem的发送缓冲区</span></span><br><span class="line">  <span class="type">uint8_t</span> *buf = modem_get_tx_buf(p-&gt;tot_len);</span><br><span class="line">  pbuf_copy_partial(p, buf, p-&gt;tot_len, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">// 触发硬件发送</span></span><br><span class="line">  modem_mac_send(buf, p-&gt;tot_len);</span><br><span class="line">  <span class="keyword">return</span> ERR_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收中断处理函数（硬件触发）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">modem_mac_rx_irq</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="type">uint32_t</span> len = modem_get_rx_len();</span><br><span class="line">  <span class="type">uint8_t</span> *buf = modem_get_rx_buf();</span><br><span class="line">  <span class="comment">// 将接收数据封装为pbuf</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">pbuf</span> *<span class="title">p</span> =</span> pbuf_alloc(PBUF_RAW, len, PBUF_POOL);</span><br><span class="line">  <span class="keyword">if</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    pbuf_take(p, buf, len);</span><br><span class="line">    <span class="comment">// 提交给LwIP协议栈</span></span><br><span class="line">    netif-&gt;input(p, netif);</span><br><span class="line">  &#125;</span><br><span class="line">  modem_release_rx_buf();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-操作系统适配：sys-arch-层实现"><a href="#2-操作系统适配：sys-arch-层实现" class="headerlink" title="2. 操作系统适配：sys_arch 层实现"></a>2. 操作系统适配：sys_arch 层实现</h3><p>LwIP 依赖操作系统提供的线程、信号量、邮箱等基础服务，需实现<code>sys_arch.h</code>中定义的抽象接口（以 ThreadX 为例）：</p>
<table>
<thead>
<tr>
<th>LwIP 接口</th>
<th>ThreadX 实现</th>
<th>功能说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>sys_mutex_t</code></td>
<td><code>TX_MUTEX</code></td>
<td>互斥锁，保护共享资源</td>
</tr>
<tr>
<td><code>sys_sem_t</code></td>
<td><code>TX_SEMAPHORE</code></td>
<td>信号量，用于同步操作</td>
</tr>
<tr>
<td><code>sys_mbox_t</code></td>
<td><code>TX_QUEUE</code></td>
<td>邮箱，用于线程间消息传递</td>
</tr>
<tr>
<td><code>sys_thread_new</code></td>
<td><code>tx_thread_create</code></td>
<td>创建协议栈处理线程</td>
</tr>
</tbody></table>
<p><strong>示例：信号量实现</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建信号量</span></span><br><span class="line"><span class="type">sys_sem_t</span> <span class="title function_">sys_sem_new</span><span class="params">(<span class="type">uint8_t</span> count)</span> &#123;</span><br><span class="line">  TX_SEMAPHORE *sem = (TX_SEMAPHORE *)modem_malloc(<span class="keyword">sizeof</span>(TX_SEMAPHORE));</span><br><span class="line">  tx_semaphore_create(sem, <span class="string">&quot;lwip_sem&quot;</span>, count);</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">sys_sem_t</span>)sem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待信号量</span></span><br><span class="line"><span class="type">err_t</span> <span class="title function_">sys_sem_wait</span><span class="params">(<span class="type">sys_sem_t</span> sem, <span class="type">uint32_t</span> timeout)</span> &#123;</span><br><span class="line">  UINT ret = tx_semaphore_get((TX_SEMAPHORE *)sem, </span><br><span class="line">                             timeout == <span class="number">0</span> ? TX_NO_WAIT : timeout);</span><br><span class="line">  <span class="keyword">return</span> (ret == TX_SUCCESS) ? ERR_OK : ERR_TIMEOUT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-协议栈配置：功能裁剪与参数优化"><a href="#3-协议栈配置：功能裁剪与参数优化" class="headerlink" title="3. 协议栈配置：功能裁剪与参数优化"></a>3. 协议栈配置：功能裁剪与参数优化</h3><p>通过<code>lwipopts.h</code>配置文件裁剪 LwIP 功能，仅保留心跳代理所需模块：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使能IPv4和IPv6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LWIP_IPV4 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LWIP_IPV6 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使能TCP和UDP（心跳包通常基于这两种协议）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LWIP_TCP 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LWIP_UDP 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭不需要的功能（如DHCP、DNS，Modem通常通过AT指令获取网络配置）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LWIP_DHCP 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LWIP_DNS 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 优化内存配置（根据Modem RAM大小调整）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEM_SIZE 65536                  <span class="comment">// 内存池大小：64KB</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEMP_NUM_NETIF 1                <span class="comment">// 仅需1个网络接口</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEMP_NUM_TCP_PCB 4              <span class="comment">// 最多同时处理4个TCP连接</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEMP_NUM_UDP_PCB 8              <span class="comment">// 最多同时处理8个UDP连接</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TCP_WND 2048                    <span class="comment">// TCP窗口大小：2KB</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TCP_MSS 1460                    <span class="comment">// TCP最大分段大小</span></span></span><br></pre></td></tr></table></figure>

<h3 id="4-初始化流程：协议栈启动与网络配置"><a href="#4-初始化流程：协议栈启动与网络配置" class="headerlink" title="4. 初始化流程：协议栈启动与网络配置"></a>4. 初始化流程：协议栈启动与网络配置</h3><p>完成适配后，需在 Modem 启动时初始化 LwIP 并配置网络参数（IP 地址、网关等，通常从 AP 或基站获取）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">lwip_modem_init</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 初始化LwIP核心模块</span></span><br><span class="line">  lwip_init();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 初始化网络接口</span></span><br><span class="line">  <span class="type">ip4_addr_t</span> ipaddr, netmask, gw;</span><br><span class="line">  IP4_ADDR(&amp;ipaddr, <span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">2</span>);    <span class="comment">// Modem的IPv4地址</span></span><br><span class="line">  IP4_ADDR(&amp;netmask, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>); <span class="comment">// 子网掩码</span></span><br><span class="line">  IP4_ADDR(&amp;gw, <span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">1</span>);        <span class="comment">// 网关地址</span></span><br><span class="line">  netif_add(&amp;modem_netif, &amp;ipaddr, &amp;netmask, &amp;gw, </span><br><span class="line">           <span class="literal">NULL</span>, low_level_init, ethernet_input);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 使能网络接口</span></span><br><span class="line">  netif_set_default(&amp;modem_netif);</span><br><span class="line">  netif_set_up(&amp;modem_netif);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 创建LwIP处理线程（优先级低于Modem核心通信任务）</span></span><br><span class="line">  tx_thread_create(&amp;lwip_thread, <span class="string">&quot;lwip_thread&quot;</span>, </span><br><span class="line">                  lwip_process, <span class="literal">NULL</span>,</span><br><span class="line">                  lwip_thread_stack, LWIP_THREAD_STACK_SIZE,</span><br><span class="line">                  <span class="number">10</span>, <span class="number">10</span>, TX_NO_TIME_SLICE, TX_AUTO_START);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LwIP处理线程（循环处理协议栈事件）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">lwip_process</span><span class="params">(ULONG param)</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// 处理TCP定时器事件（如重传、超时）</span></span><br><span class="line">    tcp_tmr();</span><br><span class="line">    <span class="comment">// 处理IP定时器事件（如分片超时）</span></span><br><span class="line">    ip_reass_tmr();</span><br><span class="line">    <span class="comment">// 延迟10ms（平衡实时性与CPU占用）</span></span><br><span class="line">    tx_thread_sleep(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="心跳代理核心逻辑：包解析与代理回复"><a href="#心跳代理核心逻辑：包解析与代理回复" class="headerlink" title="心跳代理核心逻辑：包解析与代理回复"></a>心跳代理核心逻辑：包解析与代理回复</h2><p>Modem 代理 AP 心跳的核心是识别 AP 的心跳包特征（如目的 IP、端口、 payload 格式），在 AP 休眠时直接生成回复包，避免唤醒 AP。</p>
<h3 id="1-数据包捕获与解析"><a href="#1-数据包捕获与解析" class="headerlink" title="1. 数据包捕获与解析"></a>1. 数据包捕获与解析</h3><p>LwIP 通过<code>netif-&gt;input</code>函数接收数据包，需在协议栈处理前插入钩子函数，过滤并解析心跳包：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义输入函数（替代默认的ethernet_input）</span></span><br><span class="line"><span class="type">err_t</span> <span class="title function_">custom_ethernet_input</span><span class="params">(<span class="keyword">struct</span> pbuf *p, <span class="keyword">struct</span> netif *netif)</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">eth_hdr</span> *<span class="title">ethhdr</span> =</span> pbuf_header(p, -PBUF_IP_HLEN); <span class="comment">// 获取以太网头部</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 判断协议类型（IPv4或IPv6）</span></span><br><span class="line">  <span class="keyword">if</span> (ntohs(ethhdr-&gt;type) == ETHTYPE_IP) &#123;</span><br><span class="line">    <span class="comment">// 解析IPv4包</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ip_hdr</span> *<span class="title">iphdr</span> =</span> (<span class="keyword">struct</span> ip_hdr *)p-&gt;payload;</span><br><span class="line">    <span class="keyword">if</span> (iphdr-&gt;version == <span class="number">4</span>) &#123;</span><br><span class="line">      handle_ipv4_packet(p, iphdr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ntohs(ethhdr-&gt;type) == ETHTYPE_IPV6) &#123;</span><br><span class="line">    <span class="comment">// 解析IPv6包</span></span><br><span class="line">    <span class="keyword">struct</span> ip6_hdr *ip6hdr = (<span class="keyword">struct</span> ip6_hdr *)p-&gt;payload;</span><br><span class="line">    handle_ipv6_packet(p, ip6hdr);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 若不是心跳包，交给LwIP正常处理（如转发给AP）</span></span><br><span class="line">  <span class="keyword">return</span> ethernet_input(p, netif);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IPv4包处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handle_ipv4_packet</span><span class="params">(<span class="keyword">struct</span> pbuf *p, <span class="keyword">struct</span> ip_hdr *iphdr)</span> &#123;</span><br><span class="line">  <span class="type">uint16_t</span> src_port, dst_port;</span><br><span class="line">  <span class="comment">// 判断传输层协议（TCP/UDP）</span></span><br><span class="line">  <span class="keyword">if</span> (iphdr-&gt;protocol == IP_PROTO_TCP) &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcp_hdr</span> *<span class="title">tcphdr</span> =</span> (<span class="keyword">struct</span> tcp_hdr *)((<span class="type">uint8_t</span> *)iphdr + IPH_HL(iphdr)*<span class="number">4</span>);</span><br><span class="line">    src_port = ntohs(tcphdr-&gt;src);</span><br><span class="line">    dst_port = ntohs(tcphdr-&gt;dest);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (iphdr-&gt;protocol == IP_PROTO_UDP) &#123;</span><br><span class="line">    <span class="keyword">struct</span> udp_hdr *udphdr = (<span class="keyword">struct</span> udp_hdr *)((<span class="type">uint8_t</span> *)iphdr + IPH_HL(iphdr)*<span class="number">4</span>);</span><br><span class="line">    src_port = ntohs(udphdr-&gt;src);</span><br><span class="line">    dst_port = ntohs(udphdr-&gt;dest);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 匹配心跳包特征（例如：目的IP为推送服务器，端口为8080）</span></span><br><span class="line">  <span class="keyword">if</span> (ip4_addr_cmp(&amp;iphdr-&gt;dest, &amp;push_server_ipv4) &amp;&amp; dst_port == <span class="number">8080</span>) &#123;</span><br><span class="line">    <span class="comment">// 检查AP是否处于休眠状态</span></span><br><span class="line">    <span class="keyword">if</span> (ap_is_sleeping()) &#123;</span><br><span class="line">      <span class="comment">// 代理回复心跳包</span></span><br><span class="line">      proxy_heartbeat_reply(p, iphdr);</span><br><span class="line">      pbuf_free(p); <span class="comment">// 已处理，释放pbuf</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-代理回复包生成"><a href="#2-代理回复包生成" class="headerlink" title="2. 代理回复包生成"></a>2. 代理回复包生成</h3><p>生成回复包时需交换源 &#x2F; 目的地址和端口，并保持应用层 payload 格式一致（如回声回复或固定格式应答）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">proxy_heartbeat_reply</span><span class="params">(<span class="keyword">struct</span> pbuf *req_p, <span class="keyword">struct</span> ip_hdr *req_iphdr)</span> &#123;</span><br><span class="line">  <span class="comment">// 分配回复包缓冲区</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">pbuf</span> *<span class="title">resp_p</span> =</span> pbuf_alloc(PBUF_RAW, req_p-&gt;tot_len, PBUF_POOL);</span><br><span class="line">  <span class="keyword">if</span> (resp_p == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 复制并修改IP头部（交换源/目的IP）</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ip_hdr</span> *<span class="title">resp_iphdr</span> =</span> (<span class="keyword">struct</span> ip_hdr *)resp_p-&gt;payload;</span><br><span class="line">  <span class="built_in">memcpy</span>(resp_iphdr, req_iphdr, IPH_HL(req_iphdr)*<span class="number">4</span>);</span><br><span class="line">  ip4_addr_copy(resp_iphdr-&gt;src, req_iphdr-&gt;dest);</span><br><span class="line">  ip4_addr_copy(resp_iphdr-&gt;dest, req_iphdr-&gt;src);</span><br><span class="line">  resp_iphdr-&gt;ttl = <span class="number">64</span>; <span class="comment">// 重置TTL</span></span><br><span class="line">  resp_iphdr-&gt;checksum = <span class="number">0</span>;</span><br><span class="line">  resp_iphdr-&gt;checksum = inet_chksum(resp_iphdr, IPH_HL(resp_iphdr)*<span class="number">4</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 修改传输层头部（交换源/目的端口）</span></span><br><span class="line">  <span class="keyword">if</span> (req_iphdr-&gt;protocol == IP_PROTO_TCP) &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcp_hdr</span> *<span class="title">req_tcphdr</span> =</span> (<span class="keyword">struct</span> tcp_hdr *)((<span class="type">uint8_t</span> *)req_iphdr + IPH_HL(req_iphdr)*<span class="number">4</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcp_hdr</span> *<span class="title">resp_tcphdr</span> =</span> (<span class="keyword">struct</span> tcp_hdr *)((<span class="type">uint8_t</span> *)resp_iphdr + IPH_HL(resp_iphdr)*<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(resp_tcphdr, req_tcphdr, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tcp_hdr));</span><br><span class="line">    resp_tcphdr-&gt;src = req_tcphdr-&gt;dest;</span><br><span class="line">    resp_tcphdr-&gt;dest = req_tcphdr-&gt;src;</span><br><span class="line">    resp_tcphdr-&gt;seq = htonl(ntohl(req_tcphdr-&gt;ackno)); <span class="comment">// 调整序列号</span></span><br><span class="line">    resp_tcphdr-&gt;ackno = htonl(ntohl(req_tcphdr-&gt;seq) + req_tcphdr-&gt;syn + req_tcphdr-&gt;fin + pbuf_len(req_p) - IPH_HL(req_iphdr)*<span class="number">4</span> - TCP_HLEN);</span><br><span class="line">    resp_tcphdr-&gt;checksum = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 计算TCP校验和（包含伪头部）</span></span><br><span class="line">    resp_tcphdr-&gt;checksum = tcp_chksum(resp_p, &amp;resp_iphdr-&gt;src, &amp;resp_iphdr-&gt;dest);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 复制应用层payload（保持不变）</span></span><br><span class="line">  <span class="type">uint8_t</span> *req_payload = (<span class="type">uint8_t</span> *)req_iphdr + IPH_HL(req_iphdr)*<span class="number">4</span> + (req_iphdr-&gt;protocol == IP_PROTO_TCP ? TCP_HLEN : UDP_HLEN);</span><br><span class="line">  <span class="type">uint8_t</span> *resp_payload = (<span class="type">uint8_t</span> *)resp_iphdr + IPH_HL(resp_iphdr)*<span class="number">4</span> + (resp_iphdr-&gt;protocol == IP_PROTO_TCP ? TCP_HLEN : UDP_HLEN);</span><br><span class="line">  <span class="built_in">memcpy</span>(resp_payload, req_payload, pbuf_len(req_p) - IPH_HL(req_iphdr)*<span class="number">4</span> - (req_iphdr-&gt;protocol == IP_PROTO_TCP ? TCP_HLEN : UDP_HLEN));</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 发送回复包</span></span><br><span class="line">  netif-&gt;output(netif, resp_p, &amp;resp_iphdr-&gt;dest);</span><br><span class="line">  pbuf_free(resp_p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-与-AP-的协同机制"><a href="#3-与-AP-的协同机制" class="headerlink" title="3. 与 AP 的协同机制"></a>3. 与 AP 的协同机制</h3><p>为避免代理逻辑与 AP 唤醒后的数据处理冲突，需设计简单的同步机制：</p>
<ul>
<li><p>AP 休眠前，通过共享内存告知 Modem 当前活跃的心跳连接（IP、端口、协议）；</p>
</li>
<li><p>AP 唤醒时，Modem 停止代理并将缓存的非心跳数据转发给 AP；</p>
</li>
<li><p>代理过程中若检测到异常包（如连接关闭），及时通知 AP 处理。</p>
</li>
</ul>
<h2 id="测试与优化：功耗与稳定性验证"><a href="#测试与优化：功耗与稳定性验证" class="headerlink" title="测试与优化：功耗与稳定性验证"></a>测试与优化：功耗与稳定性验证</h2><h3 id="功耗对比测试"><a href="#功耗对比测试" class="headerlink" title="功耗对比测试"></a>功耗对比测试</h3><p>在某款 4G 手机上的测试数据显示：</p>
<ul>
<li><p>传统方案：AP 每日因心跳唤醒约 2880 次（每 30 秒一次），待机电流平均 12mA；</p>
</li>
<li><p>代理方案：AP 每日唤醒次数降至≤100 次（仅处理非代理数据），待机电流降至 7mA，功耗降低约 41.7%。</p>
</li>
</ul>
<h3 id="稳定性优化"><a href="#稳定性优化" class="headerlink" title="稳定性优化"></a>稳定性优化</h3><ul>
<li><p><strong>包解析容错</strong>：增加对畸形包（如长度异常、校验和错误）的过滤，避免 Modem 异常；</p>
</li>
<li><p><strong>连接状态同步</strong>：定期与 AP 同步 TCP 连接状态（如窗口大小、序列号），防止代理回复导致连接中断；</p>
</li>
<li><p><strong>资源监控</strong>：在 LwIP 中增加内存池使用率监控，避免内存泄漏导致 Modem 重启。</p>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过将 LwIP 协议栈移植到 Modem，实现心跳包的代理回复，是一种低成本、高收益的功耗优化方案。该方案的核心在于利用 LwIP 的轻量性适配 Modem 资源约束，通过精准的包解析与代理逻辑减少 AP 唤醒。实际应用中，需根据具体心跳协议（如 MQTT、XMPP）优化特征匹配规则，并通过严格的兼容性测试确保不影响上层应用体验。</p>
<p>未来可进一步扩展该方案，支持更复杂的应用层协议代理（如 HTTP 短连接），或将 LwIP 与 Modem 的基带协议栈深度融合，实现更精细化的网络数据分流。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://walking9.github.io/2021/12/05/Modem%E4%BB%A3%E7%90%86AP%E5%BF%83%E8%B7%B3%E6%96%B9%E6%A1%88/" data-id="cmesqnd7e000rg4mk6nxm1vbb" data-title="Modem代理AP心跳方案" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AP/" rel="tag">AP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LwIP/" rel="tag">LwIP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Modem/" rel="tag">Modem</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BF%83%E8%B7%B3/" rel="tag">心跳</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/08/04/%E8%93%9D%E7%89%99%E8%80%B3%E6%9C%BA%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          蓝牙耳机开发经验
        
      </div>
    </a>
  
  
    <a href="/2021/08/11/%E6%89%8B%E6%9C%BA%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">手机产品指标 —— 稳定性：技术实践与产品视角的经验总结</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title">About Me</h3>
  <div class="widget about-widget">
    <div class="about-avatar">
      <img src="/images/shiba.jpg" alt="Avatar" />
    </div>
    <div class="about-info">
      <ul>
        <li><i class="fa fa-map-marker"></i> 上海市青浦区</li>
        <li><i class="fa fa-envelope"></i> luka_auto@163.com</li>
        <li><i class="fa fa-phone"></i> 177-1515-2023</li>
        <li><i class="fa fa-briefcase"></i> C/C++工程师 @ 华为</li>
      </ul>
    </div>
    <div class="about-description">
      <p>👤 标签：程序员/toB售前/解决方案工程师/电子产品发烧友/AI忠实用户🏷️</p>
      <p>✨ 6年工作经验，曾参与多款消费电子产品研发，现负责云计算AI+数据相关产品 🚀</p>
      <p>💻 计算机语言：C/C++/Python/Go/Java 🛠️</p>
      <p>🤖 积极拥抱AGI时代，职业发展全面转型，未来瞄准AI应用领域 🎯</p>
      <p>🌟 致力于发展多元化能力：产品、运营、售前、开发等 💪</p>
      <p>🐕 欢迎关注公众号：<strong>六边形的小狗</strong> 🔍</p>
    </div>
  </div>
</div>
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/51%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">51单片机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI/" rel="tag">AI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AP/" rel="tag">AP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSDN/" rel="tag">CSDN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Github/" rel="tag">Github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hibernate/" rel="tag">Hibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/" rel="tag">IDEA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LwIP/" rel="tag">LwIP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maven/" rel="tag">Maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Modem/" rel="tag">Modem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySql/" rel="tag">MySql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt/" rel="tag">Qt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringMVC/" rel="tag">SpringMVC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Trae/" rel="tag">Trae</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web%E5%BC%80%E5%8F%91/" rel="tag">Web开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WiFi/" rel="tag">WiFi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/conclusion/" rel="tag">conclusion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nrf24l01/" rel="tag">nrf24l01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%A7%E5%93%81/" rel="tag">产品</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%98%E5%8C%96/" rel="tag">优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%9F%E8%80%97/" rel="tag">功耗</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2/" rel="tag">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" rel="tag">学习路线</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%A2%E6%88%B7%E4%BA%A4%E6%B5%81/" rel="tag">客户交流</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag">嵌入式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%83%E8%B7%B3/" rel="tag">心跳</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%9D%E8%80%83/" rel="tag">思考</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8A%80%E6%9C%AF/" rel="tag">技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8B%9B%E8%81%98%E6%B1%82%E8%81%8C%E5%B9%B3%E5%8F%B0-%E7%9F%AD%E5%89%A7-%E4%BA%A7%E5%93%81%E9%9C%80%E6%B1%82-%E8%AE%BE%E8%AE%A1%E7%A8%BF/" rel="tag">招聘求职平台 短剧 产品需求 设计稿</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97/" rel="tag">数值计算</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E5%AD%A6/" rel="tag">数学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8C%85%E5%A4%84%E7%90%86/" rel="tag">数据包处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/" rel="tag">文件操作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1/" rel="tag">无线通信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%AA%E6%AF%94%E5%B7%B4%E6%B3%A2%F0%9F%A4%90/" rel="tag">歪比巴波🤐</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" rel="tag">海量数据处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E9%AA%8C/" rel="tag">经验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%9E%B6%E6%9E%84%E5%B8%88/" rel="tag">解决方案架构师</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/" rel="tag">软件开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%98%BF%E9%87%8C/" rel="tag">阿里</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%F0%9F%A4%90/" rel="tag">🤐</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/51%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 17.5px;">51单片机</a> <a href="/tags/AI/" style="font-size: 12.5px;">AI</a> <a href="/tags/AP/" style="font-size: 10px;">AP</a> <a href="/tags/C/" style="font-size: 10px;">C++</a> <a href="/tags/CSDN/" style="font-size: 10px;">CSDN</a> <a href="/tags/Github/" style="font-size: 10px;">Github</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hibernate/" style="font-size: 10px;">Hibernate</a> <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/LwIP/" style="font-size: 10px;">LwIP</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/Modem/" style="font-size: 10px;">Modem</a> <a href="/tags/MySql/" style="font-size: 10px;">MySql</a> <a href="/tags/Qt/" style="font-size: 10px;">Qt</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SpringMVC/" style="font-size: 10px;">SpringMVC</a> <a href="/tags/Trae/" style="font-size: 10px;">Trae</a> <a href="/tags/Web%E5%BC%80%E5%8F%91/" style="font-size: 10px;">Web开发</a> <a href="/tags/WiFi/" style="font-size: 10px;">WiFi</a> <a href="/tags/conclusion/" style="font-size: 10px;">conclusion</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/nrf24l01/" style="font-size: 10px;">nrf24l01</a> <a href="/tags/%E4%BA%A7%E5%93%81/" style="font-size: 10px;">产品</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 10px;">优化</a> <a href="/tags/%E5%8A%9F%E8%80%97/" style="font-size: 10px;">功耗</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 17.5px;">单片机</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 10px;">博客</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" style="font-size: 10px;">学习路线</a> <a href="/tags/%E5%AE%A2%E6%88%B7%E4%BA%A4%E6%B5%81/" style="font-size: 10px;">客户交流</a> <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 20px;">嵌入式</a> <a href="/tags/%E5%BF%83%E8%B7%B3/" style="font-size: 10px;">心跳</a> <a href="/tags/%E6%80%9D%E8%80%83/" style="font-size: 10px;">思考</a> <a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 12.5px;">技术</a> <a href="/tags/%E6%8B%9B%E8%81%98%E6%B1%82%E8%81%8C%E5%B9%B3%E5%8F%B0-%E7%9F%AD%E5%89%A7-%E4%BA%A7%E5%93%81%E9%9C%80%E6%B1%82-%E8%AE%BE%E8%AE%A1%E7%A8%BF/" style="font-size: 10px;">招聘求职平台 短剧 产品需求 设计稿</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">操作系统</a> <a href="/tags/%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97/" style="font-size: 15px;">数值计算</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 15px;">数学</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%8C%85%E5%A4%84%E7%90%86/" style="font-size: 10px;">数据包处理</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/" style="font-size: 10px;">文件操作</a> <a href="/tags/%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1/" style="font-size: 12.5px;">无线通信</a> <a href="/tags/%E6%AD%AA%E6%AF%94%E5%B7%B4%E6%B3%A2%F0%9F%A4%90/" style="font-size: 10px;">歪比巴波🤐</a> <a href="/tags/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" style="font-size: 10px;">海量数据处理</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 15px;">算法</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 10px;">经验</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">编程</a> <a href="/tags/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%9E%B6%E6%9E%84%E5%B8%88/" style="font-size: 10px;">解决方案架构师</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/" style="font-size: 10px;">软件开发</a> <a href="/tags/%E9%98%BF%E9%87%8C/" style="font-size: 10px;">阿里</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 10px;">面试</a> <a href="/tags/%F0%9F%A4%90/" style="font-size: 10px;">🤐</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">八月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/07/">七月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">十二月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/08/25/%E6%8B%9B%E8%81%98%E6%B1%82%E8%81%8C%E5%B9%B3%E5%8F%B0-%E4%BA%A7%E5%93%81%E9%9C%80%E6%B1%82%E5%92%8C%E8%AE%BE%E8%AE%A1%E7%A8%BF-%E7%9F%AD%E5%89%A7/">招聘求职平台-产品需求和设计稿-短剧</a>
          </li>
        
          <li>
            <a href="/2025/08/10/%E7%94%A8Trae%E4%BB%8E0%E5%88%B01%E6%89%93%E9%80%A0%E6%83%85%E7%BB%AA%E7%96%97%E6%84%88App%E5%AE%9E%E6%88%98%E8%AE%B0%E5%BD%95/">用Trae从0到1打造情绪疗愈App实战记录</a>
          </li>
        
          <li>
            <a href="/2025/08/06/%E6%88%91%E7%9A%84%E8%B4%BE%E7%BB%B4%E6%96%AF/">在AI时代，拥有属于你的“贾维斯”</a>
          </li>
        
          <li>
            <a href="/2025/07/27/2025.07.27%E6%97%A5%E8%AE%B0/">2025.07.27日记</a>
          </li>
        
          <li>
            <a href="/2025/07/24/2025.07.24%E6%97%A5%E8%AE%B0/">2025.07.24日记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Walking9<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>